三个时间：事件时间，进入flink到时间，处理时间  

## watermark

数据密集情况，应周期性产生watermark  
通过设置延迟，保证正确处理乱序数据  
是基于数据的时间戳生成的  

### 延时时间怎么设

先从历史数据中看规律，一般延迟是网络等因素，一般是几百毫秒  

### 范型方法用法

forMonotonousTimestamps watermark生成器  
withTimestampAssigner从数据里面提取时间戳  
```java
static <T> WatermarkStrategy<T> forMonotonousTimestamps() {
    return (ctx) -> {
        return new AscendingTimestampsWatermarks();
    };
}
```
forMonotonousTimestamps是一个范型方法，按如下方法使用：  
```java
WatermarkStrategy.<Event>forMonotonousTimestamps()
```

### 自定义watermark

生成的两种方法：周期性、断点式  

### 水位线的传递

第一个分区数据到来，最小的时间定为watermark如2，再来一个分区，最小时间为3，则更新watermark为3，同时广播水位线

## 窗口

窗口分类：  
按驱动类型分： 时间窗口、计数窗口  
按窗口分配数据的规则分： 滚动窗口、滑动窗口  

滚动窗口，按相同时间切片，不重叠，就一个参数，滚动窗口是特殊的滑动窗口    
滑动窗口，两个参数，窗口大小，滑动距离（计算频率），会重叠  
会话窗口，会话超时时间，gap值，窗口长度不确定，起始时间结束时间不确定  
全局窗口，相同key的所有数据都分配到一个窗口，没有结束时间，不会触发计算，所以要自定义触发器  
countWindow底层就是全局窗口  

按键分区窗口：keyBy之后再开窗  
非按键分区窗口  

Api中滚动时间窗口函数，其中有两个参数的，后面一个是offset，用于不同时区适配  
会话窗口函数： EventTimeSessionWindows  

### 增量聚合函数

flink中有两个增量聚合函数：ReduceFunction（归约函数）、AggregateFunction  

WindowTest涉及70-73，不完整  